// Imports
const Field = require('field')
const myField = new Field((Math.floor(Math.random() * 10)), (Math.floor(Math.random() * 10)), (Math.floor(Math.random() * 30)));
const prompt = require("prompt-sync")({
    sigint: true
  });


// foundational variables ================================================================
const hat = "^";
const hole = "O";
const pathCharacter = "*";
let foundHat = false;
let inHole = false;
let outOfBounds = false;
let currentX = 0;
let currentY = 0;

//Possible moves functions ================================================================
function moveRight() {
    currentX += 1;
}

function moveLeft() {
    currentX -= 1;
}

function moveDown() {
    currentY += 1;
}

function moveUp() {
    currentY -= 1;
}
//=========================================================================================
function fellInHole() {
    console.log("You lose! You fell in a hole!");
    inHole = true;
};

function outOfBoundsAction() {
    console.log("You lose! You went out of bounds!");
    outOfBounds = true;
};

function foundHatAction() {
    console.log("You win! You found your hat!");
    foundHat = true;
};

//=========================================================================================

function checkCondition() {

    if (myField.field[currentY][currentX] === hole) {
        fellInHole();
    };

    if (((currentY < 0) ||
            (currentX < 0) ||
            (currentX > myField.fieldWidth - 1) ||
            (currentY > myField.fieldHeight - 1))) {

        outOfBoundsAction();
    };

    if (myField.field[currentY][currentX] === hat) {
        foundHatAction();
    };
}

//==========================================================================================



function move() {

    while ((!inHole || !outOfBounds || !foundHat)) {
        myField.print();

        let move = prompt("What direction? (u, d, l, r)");
        const validMoves = ["u", "d", "l", "r"];
        if (!validMoves.includes(move)) {
            console.log("invalid move, please try again!");
            continue;
        }
        if (move === 'r') {
            moveRight();
        }
        if (move === 'l') {
            moveLeft();
        }

        if (move === 'u') {
            moveUp();
        }
        if (move === 'd') {
            moveDown();
        }


        checkCondition();


        myField.field[currentY].splice([currentX], 1, pathCharacter);
        myField.print()
    }


}


module.exports = move();

// LEGACY CODE ===========================================================================================================

// //moveRight()
// currentX += 1;

// //moveLeft()
// currentX -= 1;

// //moveDown()
// currentY += 1;

// //moveUp()
// currentY -= 1;

// let validMoves = ["u", "d", "l", "r"];
// let move = prompt("What direction? (u, d, l, r)");
// if (!validMoves.includes(move)) {
//   console.log("invalid move, please try again!");
//   continue;
// } else if (move === "u") {
//   currentY -= 1;
//   if (currentY < 0) {
//     console.log("You lose! You went out of bounds!");
//     outOfBounds = true;
//   } else if (myField.field[currentY][currentX] === hole) {
//     console.log("You lose! You fell in a hole!");
//     inHole = true;
//   } else if (myField.field[currentY][currentX] === hat) {
//     console.log("You win! You found your hat!");
//     foundHat = true;
//   }
// } else if (move === "d") {
//   currentY += 1;
//   if (currentY > myField.fieldHeight - 1) {
//     console.log("You lose! You went out of bounds!");
//     outOfBounds = true;
//     break;
//   } else if (myField.field[currentY][currentX] === hole) {
//     console.log("You lose! You fell in a hole!");
//     inHole = true;
//   } else if (myField.field[currentY][currentX] === hat) {
//     console.log("You win! You found your hat!");
//     foundHat = true;
//   }
// } else if (move === "l") {
//     currentX -= 1;
//     if (currentX < 0) {
//         console.log("You lose! You went out of bounds!");
//         outOfBounds = true;
//     } else if (myField.field[currentY][currentX] === hole) {
//         console.log("You lose! You fell in a hole!");
//         inHole = true;
//     } else if (myField.field[currentY][currentX] === hat) {
//         console.log("You win! You found your hat!");
//         foundHat = true;
//     }
// } else if (move === "r") {
//   currentX += 1;
//   if (currentX > myField.fieldWidth - 1) {
//     console.log("You lose! You went out of bounds!");
//     outOfBounds = true;
//   } else if (myField.field[currentY][currentX] === hole) {
//     console.log("You lose! You fell in a hole!");
//     inHole = true;
//   } else if (myField.field[currentY][currentX] === hat) {
//     console.log("You win! You found your hat!");
//     foundHat = true;
//   }
// }
//     if  {
//         break;
//     }
//     myField.field[currentY].splice([currentX], 1, pathCharacter);

//   }
// }